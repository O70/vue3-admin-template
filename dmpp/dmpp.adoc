:toc-title: Data Middle Platform of Personnel
// :toc: left
:toclevels: 4
:source-highlighter: rouge

= {toc-title}

== Important

* [ ] ✨Login
** [ ] Send verification code
** [ ] Refactor login method
** [ ] Mobile authenticate
* [x] Avatar
* [x] Profiles修改
* [x] 修改字段可配置
* [x] 质疑修改(工单)
* [x] 获取百分比
* [x] ✅后台手动百分比计算(AOP暂延)
* [x] ❌ Deprecated: AOP计算百分比，后台无操作
* [x] ❌ Dicts API
* [x] Databases schema name
* [ ] Auditor
* [ ] Security...

* [x] 国籍
* [x] 民族
* [x] 业务类型
* [x] Worker: username
* [x] Org: shortName
* [x] Worker: 百分比统计减册原因如何计算
* [ ] Org: name history patch
* [ ] Gang: gangBranch String => Org

* [ ] 数据初始化
** [ ] Opt: proportion/reset
** [ ] Topic
** [ ] 工作经历未找到
* [ ] 项目构建 - Docker(F/B)
* [ ] 测试

* [ ] 下周一第一版测试

=== Data init

* [x] 基本信息
* [x] 家庭信息
* [x] 工作信息
** [x] 工作信息
** [x] 合同信息  
* [x] 履历信息 
** [x] 教育经历 
** [x] 工作经历  
** [x] 职务信息  
** [x] 职称信息
* [x] 党务信息: 模拟许数据： DICT_POLITICAL_FACE_DY | 2020-01-01 | 信息技术中心党支部(ORG_ALL_A42) | DICT_GANG_TITLE_DZBQNWY;**正在整理正式数据**
* [ ] 培训经历： 需要加年度查询条件
* [x] 科研项目
* [x] 知识产权
** [x] 中国专利
** [x] 国外专利
** [x] 软件著作权
** [x] 技术秘密
** [x] 论文著作
** [x] 技术标准
* [ ] 奖励信息
** [x] 科研奖励
** [ ] 党内奖励
** [x] 荣誉称号
* [ ] 学术活动: 无数据来源
* [x] 自我评定: 无数据来源,对应题目已模拟

=== Init Question

* [x] 职务职称数据重导
* [x] 学历学位处理
* [x] 职级之类的字典校对
* [x] 最高学历学位
* [x] 重构科研项目初始化逻辑
* [x] PaperExcelTests 太慢 15min53sec
* [x] 党务信息两个表人员不对应的筛选出来
* [ ] 百分比初始化优化，API按id初始化，test一次性查询再做转换
* [x] Gang: 转正时间是否展示？如果不展示百分比是否将此字段纳入计算范围内
* [x] Gang: 党组织未找到-> org party
* [x] 奖励信息百分比，有三个表格，计算方式应该分成三份，若其中一个表格有至少1条数据便为1，最终1/3
* [ ] 初始化产生的excel输出至``build/init-excels``
* [ ] 基本信息：工作信息 === 1:n 
* [ ] Train: 数据来源清洗
* [x] Family: 映射找不到就用其他。关系字典等待重构
* [ ] Gang: 个人党内奖励，集团不用管
* [ ] Gang: 当前党内职务历史也需要作为历史职务
* [ ] Gang: 当前党内职务修改后是否会增加历史记录
* [ ] 知识产权，类似全部作者或科研项目的成员需要存起来
* [ ] Contract: 根据开始时间和结束时间计算合同类型，必需两个时间存在
* [ ] 武处专利数量对不上

=== Initialization Flow

* 1. Check ``dmpp.datasource.database`` / ``dmpp.datasource.host`` / ``spring.datasource.password``
* 2. Set ``spring.jpa.hibernate.ddl-auto=create``
* 3. InitializationPedestal: remove ``@Disabled``
* 4. Run ``InitializationPedestal.initSystem`` 
* 5.Set ``spring.jpa.hibernate.ddl-auto=update``
* 6. Run ``InitializationPedestal.initPart``
* 7. Remove ``@Disabled``, run ``InitializationExcel`` 
* 8. Remove ``@Disabled``, run ``InitializationOther``
* 9. Rest code and configuration

== Docs

- [ ] Profiles modify tests: `/supplier/profiles/changer`
- [ ] Get poportion tests: `/supplier/profiles/proportion`
- [ ] Reset poportion tests: `/supplier/profiles/proportion/reset`
- [ ] Profiles cheats
    * [ ] Get all cheats: `/supplier/profiles/cheats/init`
    * [ ] Update cheats
    * [ ] Init cheats: `/supplier/profiles/cheats/init`


== APIS

- [ ] Dict / Org findByCodes and unique api
- [x] Supplier profiles
- [x] ❌ Deprecated: Optimize profiles api performance
- [x] Profile completion percentage
- [x] Find Dict by codes

Adapter

== Tasks

- [ ] List / Page List query conditions(pagation)
- [ ] Fix method `org.thraex.toolkit.model.AbstractTree#toTree`
- [ ] **modules** refactored into microservices: modular / entity /service / repository
- [x] remove `thraex.supplier.mock-prefix`
- [ ] Optimization `@EnableGeneric` annotations, add `boolean genericRouterFunction() default true;` / `boolean enableWebFluxSecurity() default false;`
- [ ] Optimization `EnableGenericSecurity`: move to `@EnableGeneric`
- [x] Refactor databases table name
- [ ] Refactor **Tests**, change MySQL to H2. Optimization performance
- [ ] Optimization security / token
- [ ] Remove `Avatar`
- [ ] `JpaEntity` change to `Auditable`
- [ ] `AuditorAware` -> `ReactiveAuditorAware`
- [ ] Foreign key for `@OneToMany`
- [ ] `CompletableFuture`
- [ ] Move `DmppImplicitNamingStrategy` to Generic
- [ ] Optimization WebFluxSecurityConfiguration

## Questions

- FamilyServiceImpl: // TODO: Question...
- Empty to null ? throw exception
- (if else) to (? :)
- Blank line

## Configuration

.main application-local.yml
[,yaml]
----
spring:
  jackson:
    default-property-inclusion: always
  datasource:
    url: jdbc:mysql://localhost:3307/dmpp_pedestal?useSSL=false&characterEncoding=utf-8&serverTimezone=Asia/Shanghai
    password: hanzo
  jpa:
#    hibernate:
#      ddl-auto: create
    show-sql: true

logging:
  level:
    org.thraex: trace

thraex:
  security:
    token:
      exp: 720
#thraex:
#  security:
#    permitted:
#      - /docs/**
#      - /**
minio:
  url: http://localhost:9000
  access-key: root
  secret-key: minio-admin
  bucket: dev
  web-url: ${minio.url}/${minio.bucket}/
----

.test application-local.yml
[,yaml]
----
spring:
  jackson:
    default-property-inclusion: always
  datasource:
    url: jdbc:mysql://localhost:3307/dmpp_pedestal_docs?useSSL=false&characterEncoding=utf-8&serverTimezone=Asia/Shanghai
    password: hanzo

debug: true

minio:
  url: http://localhost:9000
  access-key: root
  secret-key: minio-admin
  bucket: dev
  web-url: ${minio.url}/${minio.bucket}/
----
